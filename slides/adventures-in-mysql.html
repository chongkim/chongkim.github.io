<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Adventures in MySQL with Chong Kim</title>

    <meta name="description" content="Things I've learned about databases, MySQL in particular.">
    <meta name="author" content="Chong Oh Kim">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
      <script src="lib/js/html5shiv.js"></script>
      <![endif]-->
    </head>
    <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <section>
            <h1>1995</h1>
          </section>
          <section>
            <p>Handling Persistence</p>

            <ul>
              <li class="fragment">Flat files</li>
              <li class="fragment"><code>fseek()</code> and <code>ftell()</code>
              <li class="fragment"><code>mmap()</code></li>
            </ul>
          </section>
          <section>
            <img src="img/introduction_to_algorithms.jpg" alt=""/>
          </section>
          <section data-markdown>
            Introduction To Algorithms
            * Red Black Tree
            * B-Tree
          </section>
        </section>
        <section>
          <section>
            <h1>BASIC SQL</h1>
          </section>
          <section data-markdown>
            Help

            * help contents
            * help data definition
            * help data manipulation
            * help functions
          </section>
          <section>
            <p>Crash Course in SQL</p>

            <ul>
              <li>display results (like a print statement)</li>
              <li>create a table</li>
              <li>insert into a table</li>
              <li>delete from a table</li>
              <li>select rows from a table</li>
              <li>drop a table</li>
            </ul>
          </section>
          <section>
            <p>Displaying results</p>
            <div class="fragment" data-markdown>
              ```sql
              mysql> select 'hello world';
              ```
              </div>
            <div class="fragment" data-markdown>
              ```sql
+-------------+
| hello world |
+-------------+
| hello world |
+-------------+
1 row in set (0.00 sec)
              ```
            </div>

            <div class="fragment" data-markdown>
              ```sql
mysql> select 'hello world' result;
+-------------+
| result      |
+-------------+
| hello world |
+-------------+
1 row in set (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
mysql> select 'hello world' as `result`;
+-------------+
| result      |
+-------------+
| hello world |
+-------------+
1 row in set (0.00 sec)
              ```
            </div>
          </section>
          <section data-markdown>
            Using `SELECT`
            ```sql
            mysql> select 1 + 2 as result, database(), version(), user();
            +--------+------------+-----------+----------------+
            | result | database() | version() | user()         |
            +--------+------------+-----------+----------------+
            |      3 | ckim_db    | 5.6.22    | ckim@localhost |
            +--------+------------+-----------+----------------+
            1 row in set (0.00 sec)
            ```
          </section>
          <section>
            Creating person table
            <div class="fragment" data-markdown>
              ```sql
              mysql> create table person(
                  -> name varchar(100),
                  -> title varchar(100)
                  -> );
              Query OK, 0 rows affected (0.02 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> insert into person values ('chong', 'programmer');
              Query OK, 1 row affected (0.03 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> insert into person(name, title) values ('jim', 'cto');
              Query OK, 1 row affected (0.00 sec)
              ```
            </div>
            <aside class="notes">
              Notice alternative way to insert
            </aside>
          </section>
          <section>
            Viewing person table
            <div data-markdown>
              ```sql
              mysql> select * from person;
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              +-------+------------+
              | name  | title      |
              +-------+------------+
              | chong | programmer |
              | jim   | cto        |
              +-------+------------+
              2 rows in set (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> select * from person where name='chong';
              +-------+------------+
              | name  | title      |
              +-------+------------+
              | chong | programmer |
              +-------+------------+
              1 row in set (0.00 sec)
              ```
            </div>
          </section>
          <section>
            <code>INSERT</code> using <code>SELECT</code>
            <div data-markdown>
              ```sql
              mysql> insert into person(name,title)
                  -> select name, 'CEO' from person limit 1;
              Query OK, 1 row affected (0.00 sec)
              Records: 1  Duplicates: 0  Warnings: 0
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> select * from person;
              +-------+------------+
              | name  | title      |
              +-------+------------+
              | chong | programmer |
              | jim   | cto        |
              | chong | CEO        |
              +-------+------------+
              ```
            </div>
          </section>
          <section>
            <code>DELETE FROM</code> a table
            <div data-markdown>
              ```sql
              mysql> delete from person where title='CEO';
              Query OK, 1 row affected (0.00 sec)

              mysql> select * from person;
              +-------+------------+
              | name  | title      |
              +-------+------------+
              | chong | programmer |
              | jim   | cto        |
              +-------+------------+
              2 rows in set (0.00 sec)
              ```
            </div>
          </section>
          <section>
            Dropping a table
            <div data-markdown>
              ```sql
              mysql> create table address (id bigint); -- oops
              Query OK, 0 rows affected (0.01 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> drop table address;
              Query OK, 0 rows affected (0.01 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> create table address(
                  -> id bigint primary key auto_increment,
                  -> street varchar(50),
                  -> city varchar(40),
                  -> state varchar(2)
                  -> person_id bigint);
              Query OK, 0 rows affected (0.02 sec)
              ```
            </div>
            <aside class="notes" data-markdown>
              mention
              * primary key
              * auto_increment
            </aside>
          </section>
          <section data-markdown>
            What we have so far

            ```sql
            SELECT .. [ FROM tbl [ WHERE ... ] ]

            CREATE TABLE tbl ( ... )

            INSERT INTO tbl VALUES (...)

            INSERT INTO tbl SELECT ...

            DELETE FROM tbl WHERE ...

            DROP TABLE tbl
            ```
          </section>
        </section>
        <section>
          <section><h1>Making changes</h1></section>
          <section data-markdown>
            Altering person table

            * Want to add column, `id`
            * `id` should show up first
          </section>
          <section>
            <p data-markdown>Help on `alter table`</p>
            <div data-markdown>
              ```sql
              mysql> help alter table
              ```
            </div>
            <div class="fragment" data-markdown>
              ```
Name: 'ALTER TABLE'
Description:
Syntax:
ALTER [IGNORE] TABLE tbl_name
    [alter_specification [, alter_specification] ...]
    [partition_options]

alter_specification:
    table_options
  | ADD [COLUMN] col_name column_definition
        [FIRST | AFTER col_name ]
  | ADD [COLUMN] (col_name column_definition,...)
  | ADD {INDEX|KEY} [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]] PRIMARY KEY
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        UNIQUE [INDEX|KEY] [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD FULLTEXT [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD SPATIAL [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        FOREIGN KEY [index_name] (index_col_name,...)
        reference_definition
  | ALGORITHM [=] {DEFAULT|INPLACE|COPY}
  | ALTER [COLUMN] col_name {SET DEFAULT literal | DROP DEFAULT}
  | CHANGE [COLUMN] old_col_name new_col_name column_definition
        [FIRST|AFTER col_name]
  | LOCK [=] {DEFAULT|NONE|SHARED|EXCLUSIVE}
  | MODIFY [COLUMN] col_name column_definition
        [FIRST | AFTER col_name]
  | DROP [COLUMN] col_name
  | DROP PRIMARY KEY
  | DROP {INDEX|KEY} index_name
  | DROP FOREIGN KEY fk_symbol
  | DISABLE KEYS
  | ENABLE KEYS
  | RENAME [TO|AS] new_tbl_name
  | ORDER BY col_name [, col_name] ...
  | CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
  | [DEFAULT] CHARACTER SET [=] charset_name [COLLATE [=] collation_name]
  | DISCARD TABLESPACE
  | IMPORT TABLESPACE
  | FORCE
  | ADD PARTITION (partition_definition)
  | DROP PARTITION partition_names
  | TRUNCATE PARTITION {partition_names | ALL}
  | COALESCE PARTITION number
  | REORGANIZE PARTITION partition_names INTO (partition_definitions)
  | EXCHANGE PARTITION partition_name WITH TABLE tbl_name
  | ANALYZE PARTITION {partition_names | ALL}
  | CHECK PARTITION {partition_names | ALL}
  | OPTIMIZE PARTITION {partition_names | ALL}
  | REBUILD PARTITION {partition_names | ALL}
  | REPAIR PARTITION {partition_names | ALL}
  | REMOVE PARTITIONING

index_col_name:
    col_name [(length)] [ASC | DESC]

index_type:
    USING {BTREE | HASH}

index_option:
    KEY_BLOCK_SIZE [=] value
  | index_type
  | WITH PARSER parser_name
  | COMMENT 'string'

table_options:
    table_option [[,] table_option] ...  (see CREATE TABLE options)

partition_options:
    (see CREATE TABLE options)

ALTER TABLE changes the structure of a table. For example, you can add
or delete columns, create or destroy indexes, change the type of
existing columns, or rename columns or the table itself. You can also
change characteristics such as the storage engine used for the table or
the table comment.

Following the table name, specify the alterations to be made. If none
are given, ALTER TABLE does nothing.

The syntax for many of the permissible alterations is similar to
clauses of the CREATE TABLE statement. See [HELP CREATE TABLE], for
more information.

table_options signifies table options of the kind that can be used in
the CREATE TABLE statement, such as ENGINE, AUTO_INCREMENT,
AVG_ROW_LENGTH, MAX_ROWS, or ROW_FORMAT. For a list of all table
options and a description of each, see [HELP CREATE TABLE]. However,
ALTER TABLE ignores the DATA DIRECTORY and INDEX DIRECTORY table
options.

partition_options signifies options that can be used with partitioned
tables for repartitioning, for adding, dropping, merging, and splitting
partitions, and for performing partitioning maintenance. It is possible
for an ALTER TABLE statement to contain a PARTITION BY or REMOVE
PARTITIONING clause in an addition to other alter specifications, but
the PARTITION BY or REMOVE PARTITIONING clause must be specified last
after any other specifications. The ADD PARTITION, DROP PARTITION,
COALESCE PARTITION, REORGANIZE PARTITION, EXCHANGE PARTITION, ANALYZE
PARTITION, CHECK PARTITION, and REPAIR PARTITION options cannot be
combined with other alter specifications in a single ALTER TABLE, since
the options just listed act on individual partitions. For more
information about partition options, see [HELP CREATE TABLE], and
http://dev.mysql.com/doc/refman/5.6/en/alter-table-partition-operations
.html. For information about and examples of ALTER TABLE ... EXCHANGE
PARTITION statements, see
http://dev.mysql.com/doc/refman/5.6/en/partitioning-management-range-li
st.html.

Some operations may result in warnings if attempted on a table for
which the storage engine does not support the operation. These warnings
can be displayed with SHOW WARNINGS. See [HELP SHOW WARNINGS].

For information on troubleshooting ALTER TABLE, see
http://dev.mysql.com/doc/refman/5.6/en/alter-table-problems.html.

URL: http://dev.mysql.com/doc/refman/5.6/en/alter-table.html
              ```
            </div>
          </section>
          <section>
            Altering<code> person</code>

            <div data-markdown style="width: 1050px">
              ```sql
              mysql> alter table person add id bigint primary key auto_increment first;
              Query OK, 0 rows affected (0.02 sec)
              Records: 0  Duplicates: 0  Warnings: 0
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> select * from person;
              +----+-------+------------+
              | id | name  | title      |
              +----+-------+------------+
              |  1 | chong | programmer |
              |  2 | jim   | cto        |
              +----+-------+------------+
              2 rows in set (0.00 sec)
              ```
            </div>
          </section>
        </section>
        <section>
          <section>
            <h1>Discovering your schema</h1>
          </section>
          <section>
            What does your database look like?

            <div data-markdown>
              ```sql
              show databases

              show tables

              select database();

              use dbname
              ```
            </div>
          </section>
          <section>
            How is the <code>address</code> table defined
            <div class="fragment" data-markdown>
              ```sql
              mysql> select * from address;
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              Empty set (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> show create table address;
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              +---------+-----------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----+
              | Table   | Create Table
                  |
              +---------+-----------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----+

              | address | CREATE TABLE `address` (
                `id` bigint(20) NOT NULL AUTO_INCREMENT,
                `street` varchar(50) DEFAULT NULL,
                `city` varchar(40) DEFAULT NULL,
                `state` varchar(2) DEFAULT NULL,
                `person_id` bigint(20) DEFAULT NULL,
                PRIMARY KEY (`id`)
              ) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
              +---------+-----------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----------------------------------------------------------------------
              ----+
              1 row in set (0.00 sec)
              ```
            </div>
          </section>
          <section>
            <div data-markdown>
              ```sql
              mysql> show create table address\G
              *************************** 1. row ***************************
                     Table: address
              Create Table: CREATE TABLE `address` (
                `id` bigint(20) NOT NULL AUTO_INCREMENT,
                `street` varchar(50) DEFAULT NULL,
                `city` varchar(40) DEFAULT NULL,
                `state` varchar(2) DEFAULT NULL,
                `person_id` bigint(20) DEFAULT NULL,
                PRIMARY KEY (`id`)
              ) ENGINE=InnoDB DEFAULT CHARSET=utf8
              1 row in set (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> describe address;
              +-----------+-------------+------+-----+---------+----------------+
              | Field     | Type        | Null | Key | Default | Extra          |
              +-----------+-------------+------+-----+---------+----------------+
              | id        | bigint(20)  | NO   | PRI | NULL    | auto_increment |
              | street    | varchar(50) | YES  |     | NULL    |           &nbsp;    |
              | city      | varchar(40) | YES  |     | NULL    |           &nbsp;    |
              | state     | varchar(2)  | YES  |     | NULL    |           &nbsp;    |
              | person_id | bigint(20)  | YES  |     | NULL    |           &nbsp;    |
              +-----------+-------------+------+-----+---------+----------------+
              5 rows in set (0.00 sec)
              ```
            </div>
          </section>
          <section>
            Inserting into address
            <div data-markdown>
              ```sql
              mysql> select * from person;
              +----+-------+------------+
              | id | name  | title      |
              +----+-------+------------+
              |  1 | chong | programmer |
              |  2 | jim   | cto        |
              +----+-------+------------+
              2 rows in set (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> insert into address(street, city, state, person_id)
                  -> values ('123 Sesame St', 'Tampa', 'FL', 1);
              Query OK, 1 row affected (0.00 sec)
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              mysql> select * from address;
              +----+---------------+-------+-------+-----------+
              | id | street        | city  | state | person_id |
              +----+---------------+-------+-------+-----------+
              |  1 | 123 Sesame St | Tampa | FL    |         1 |
              +----+---------------+-------+-------+-----------+
              1 row in set (0.00 sec)
              ```
            </div>
          </section>
        </section>
        <section>
          <section>
            <h1>Look up info from multiple tables</h1>
          </section>
          <section>
            <p>Joins</p>

            <div data-markdown>
              ```sql
              mysql> select name, title, street, city, state
                  -> from person join address on person.id = address.person_id;
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              +-------+------------+---------------+-------+-------+
              | name  | title      | street        | city  | state |
              +-------+------------+---------------+-------+-------+
              | chong | programmer | 123 Sesame St | Tampa | FL    |
              +-------+------------+---------------+-------+-------+
              1 row in set (0.00 sec)
              ```
            </div>
            <aside class="notes">
              No jim
            </aside>
          </section>
          <section>
            Inserting another address for 'chong'

            <div data-markdown>
              ```sql
              mysql> insert into address values
                  -> (null, '1313 Mockingbird Ln', 'Tampa', 'FL', 1);
              Query OK, 1 row affected (0.00 sec)

              mysql> select name, title, street, city, state
                  -> from person join address on person.id = address.person_id;
              +-------+------------+---------------------+-------+-------+
              | name  | title      | street           &nbsp;  | city  | state |
              +-------+------------+---------------------+-------+-------+
              | chong | programmer | 123 Sesame St       | Tampa | FL    |
              | chong | programmer | 1313 Mockingbird Ln | Tampa | FL    |
              +-------+------------+---------------------+-------+-------+
              2 rows in set (0.00 sec)
              ```
            </div>
          </section>
          <section>
            Warning: Old style
            <pre><code class="sql">mysql> select name, title, street, city, state
    -> from person p, address a
    -> where p.id = a.person_id;
+-------+------------+-----------------------+-------+-------+
| name  | title      | street                | city  | state |
+-------+------------+-----------------------+-------+-------+
| chong | programmer | 123 Sesame St         | Tampa | FL    |
| chong | programmer | 1313 Mockingbird Lane | Tampa | FL    |
+-------+------------+-----------------------+-------+-------+
2 rows in set (0.00 sec)
            </code></pre>
          </section>
        </section>
        <section>
          <section><h1>Developer's Guide to SQL</h1></section>
          <section>
            Python

            <pre><code class="python"># creating "tables"

class Person(object):
    def __init__(self, name, title):
        self.name = name
        self.title = title

class Address(object):
    def __init__(self, street, city, state, person):
        self.street = street
        self.city = city
        self.state = state
        self.person = person
            </code></pre>
          </section>
          <section>
            Python
            <pre><code class="python"># start with empty "tables"
persons = []
addresses = []

# inserting
persons.append( Person('chong', 'programmer') )
persons.append( Person('jim', 'cto') )

addresses.append( Address('123 Sesame St', 'Tampa', 'FL', persons[0]) )
addresses.append( Address('1313 Mockingbird Ln', 'Tampa', 'FL', persons[0]) )

# selecting
print [ {'name': p.name, 'title': p.title, 'street': a.street, 'city': a.city, 'state': a.state}
        for p in persons
        for a in addresses
        if p == a.person ]
</code></pre>
          </section>
          <section>
            Python

            <pre><code> # output
[
  {
    'city': 'Tampa',
    'state': 'FL',
    'street': '123 Sesame St',
    'name': 'chong',
    'title': 'programmer'
  },
  {
    'city': 'Tampa',
    'state': 'FL',
    'street': '1313 Mockingbird Ln',
    'name': 'chong',
    'title': 'programmer'
  }
]
</code></pre>
          </section>
          <section>
          Ruby
          <pre><code class="ruby">
Person = Struct.new(:name, :title)
Address = Struct.new(:street, :city, :state, :person)

persons = []
addresses = []

persons << Person.new('chong', 'programmer')
persons << Person.new('jim', 'cto')

addresses << Address.new('123 Sesame St', 'Tampa', 'FL', persons.first)
addresses << Address.new('1313 Mockingbird Ln', 'Tampa', 'FL', persons.first)

result = []
persons.each do |p|
  addresses.each do |a|
    result << { name: p.name, title: p.title, street: a.street, city: a.city, state: a.state } if a.person == p
  end
end

puts result.inspect
          </code></pre>
          </section>
          <section>
            Status: Junior Level
          </section>
        </section>
        <section>
          <section>
            <h1>Designing a schema</h1>
          </section>
          <section data-markdown>
            Normalizing

            * Don't repeat yourself
            * Keep relevant info together
            * Keep non-relevant info apart
          </section>
          <section>
            <div data-markdown>
              Bad
              ```sql
              create table person(
                id bigint primary key auto_increment,
                phone1 varchar(20),
                phone2 varchar(20),
                cubicle_location varchar(100),
                cubicle_type enum('small','medium','large'),
                name varchar(100)
              );
              ```
            </div>
          </section>
          <section>
            <div data-markdown>
              Good
              ```sql
              create table person(
                id bigint primary key auto_increment,
                name varchar(100),
                cubicle_id bigint
              );

              create table phone(
                id bigint primary key auto_increment,
                person_id bigint,
                ph_num varchar(20)
              );

              create table cubicle(
                id bigint primary key auto_increment,
                location varchar(100),
                type enum('small','medium','large')
              );
              ```
            </div>
          </section>
          <section data-markdown>
            Data Warehousing

            * ETL = Extract, Transform, Load
            * Denormalize tables
            * Read-only
            * Store huge amounts of data
            * Do mostly group calculations: `sum`, `avg`, `max`
          </section>
        </section>
        <section>
          <section>
            <h1>Problem</h1>

            <pre>
+----+------------+-------+
| id | date       | total |
+----+------------+-------+
|  1 | 2015-01-02 |    12 |
|  2 | 2015-01-03 |     8 |
|  3 | 2015-01-04 |     8 |
|  4 | 2015-01-04 |    10 |
|  5 | 2015-01-06 |     3 |
|  6 | 2015-01-10 |     1 |
+----+------------+-------+
            </pre>

            <ul>
              <li>There are days where there's no data</li>
              <li>Write a query that will include all dates given a range</li>
            </ul>
          </section>
          <section>
            create dates table

            <div data-markdown>
              ```sql
-- plant the seed
create table dates (dt date primary key);
insert into dates values ('1900-01-01');

-- run this multiple times as needed
insert into dates
select adddate(dt, tmp.n)
from dates,
     (select count(*) as n from dates) as tmp;

-- trim the fat
delete from dates
where dt < '1960-01-01'
   or dt > '2100-01-01';
              ```
            </div>
          </section>
          <section>
            Use outer joins

            <div data-markdown>
              ```sql
              mysql> select dates.dt, ds.total
                  -> from dates
                  -> left join day_summary ds on dates.dt = ds.date
                  -> where dates.dt between '2015-01-01' and '2015-01-06'
                  -> order by 1;
+------------+-------+
| dt         | total |
+------------+-------+
| 2015-01-01 |  NULL |
| 2015-01-02 |    12 |
| 2015-01-03 |     8 |
| 2015-01-04 |     8 |
| 2015-01-04 |    10 |
| 2015-01-05 |  NULL |
| 2015-01-06 |     3 |
+------------+-------+
6 rows in set (0.00 sec)
              ```
            </div>
          </section>
        </section>
        <section>
          <section>
            <h1>Problem</h1>

            <p>What table has person_id</p>
          </section>
          <section data-markdown>
            Information Schema
            <div class="fragment" data-markdown>
              ```sql
              mysql> select table_name
                  ->   from information_schema.columns
                  ->  where table_schema=database()
                  ->    and column_name='person_id';
+------------+
| table_name |
+------------+
| address    |
+------------+
1 row in set (0.00 sec)
              ```
            </div>
          </section>
        </section>
        <section>
          <section data-markdown>
            # Performance Tuning

            * `explain`
            * `analyze table`
            * `optimize table`
            * `create index`
          </section>
          <section>
            <code>explain</code>
            <div>
              <pre><code>
mysql> explain select name, street from person join address on person.id = address.person_id;
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
| id | select_type | table   | type | possible_keys | key  | key_len | ref  | rows | Extra                                              |
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
|  1 | SIMPLE      | address | ALL  | NULL          | NULL | NULL    | NULL |    2 | NULL                                               |
|  1 | SIMPLE      | person  | ALL  | PRIMARY       | NULL | NULL    | NULL |    2 | Using where; Using join buffer (Block Nested Loop) |
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
2 rows in set (0.00 sec)
              </code></pre>
            </div>
          </section>
          <section>
            create an index
            <pre><code class="sql">mysql> alter table address add index(person_id);
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> explain select name, street from person join address on person.id = address.person_id;
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
| id | select_type | table   | type | possible_keys | key  | key_len | ref  | rows | Extra                                              |
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
|  1 | SIMPLE      | address | ALL  | person_id     | NULL | NULL    | NULL |    2 | NULL                                               |
|  1 | SIMPLE      | person  | ALL  | PRIMARY       | NULL | NULL    | NULL |    2 | Using where; Using join buffer (Block Nested Loop) |
+----+-------------+---------+------+---------------+------+---------+------+------+----------------------------------------------------+
2 rows in set (0.00 sec)
</code></pre>
<pre><code class="sql fragment">mysql> insert into address(person_id) values (3); -- 7 more times...
Query OK, 1 row affected (0.00 sec)

mysql> explain select name, street from person join address on person.id = address.person_id;
+----+-------------+---------+------+---------------+-----------+---------+-------------------+------+-------+
| id | select_type | table   | type | possible_keys | key       | key_len | ref               | rows | Extra |
+----+-------------+---------+------+---------------+-----------+---------+-------------------+------+-------+
|  1 | SIMPLE      | person  | ALL  | PRIMARY       | NULL      | NULL    | NULL              |    2 | NULL  |
|  1 | SIMPLE      | address | ref  | person_id     | person_id | 9       | ckim_db.person.id |    1 | NULL  |
+----+-------------+---------+------+---------------+-----------+---------+-------------------+------+-------+
2 rows in set (0.00 sec)
            </code></pre>
          </section>
          <section>
            Cardinality
            <pre><code class="sql">mysql> show index from address where column_name ='person_id';
+---------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table   | Non_unique | Key_name  | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+---------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| address |          1 | person_id |            1 | person_id   | A         |          10 |     NULL | NULL   | YES  | BTREE      |         |               |
+---------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
1 row in set (0.00 sec)
</code></pre>
<pre><code class="sql fragment">mysql> select cardinality
    -> from information_schema.statistics
    -> where table_schema=database()
    -> and table_name='address'
    -> and column_name='person_id';
+-------------+
| cardinality |
+-------------+
|          10 |
+-------------+
1 row in set (0.00 sec)
</code></pre>
          </section>
          <section>
            Index maintenance
            <div class="fragment" data-markdown>
              ```sql
              analyze table tblname;  -- recalculate statistics
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              optimize table tblname; -- defrag
              ```
            </div>
            <div class="fragment" data-markdown>
              ```sql
              alter table address engine=myisam
              ```
            </div>
          </section>
          <section data-markdown>
            Other tools

            * show processlist;
            * slow logs
            ** show variables like 'slow%log';
          </section>
        </section>
        <section>
          <section data-markdown>
            # PROBLEM

            ![hierarchical data](img/hierarchy.png)
          </section>
          <section data-markdown>
            * Hierarchical data - http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/
          </section>
        </section>
        <section data-markdown>
        # Engines
        </section>
        <section data-markdown>
          * myisam
          * innodb
          * blackhole
        </section>
        <section data-markdown>
          Other topics

          * @@datadir
          * self joins
          * join tables 
          * \P less -S 
          * Engines
        </section>
        <section>
          <section>
            # Problem
            Who touched my table?
          </section>
          <section>
            triggers
          </section>
        </section>
        <section data-markdown>
          Other topics
          * multiple servers 
          * show variables
          * use of \P
          * replication 
          * variables 
          * batch processing
          * hashing row entries
          * ORM
        </section>
        <section data-markdown>
          Other topics
          * composite indexes
          * recovery
          * aggregate functions
          * property table
          * stored procedure
          * varchar vs binary
          * ci collation
          * my.cnf
        </section>
        <section data-markdown>
          Other topics
          * subqueries
            * one row
            * multiple rows
            * in FROM
          * set theory
            * UNION ALL
            * "MINUS"
            * intersect
          * diffing tables 
        </section>
        <section data-markdown>
          Other topics
          * SQLite 
          * group by 
          * count(*) or count(field)
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      // Optional reveal.js plugins
      dependencies: [
        { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return true; }, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: 'plugin/zoom-js/zoom.js', async: true },
        { src: 'plugin/notes/notes.js', async: true }
      ]
    });
    </script>
  </body>
</html>
